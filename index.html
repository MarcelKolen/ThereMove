<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
            integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
            integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.61/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <title>ThereMove</title>
</head>
<body>
<!-- page navigation header -->
<header>
    <nav class="navbar navbar-expand-lg navbar-light sticky-top" style="background-color: aquamarine;">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarContent">
            <div class="nav navbar-nav mr-auto" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" style="color: slategray;" id="nav-STM-tab" data-toggle="tab"
                   href="#nav-STM" role="tab" aria-controls="nav-STM" aria-selected="true">Slider to Sound</a>
                <a class="nav-item nav-link" style="color: slategray;" id="nav-MTM-tab" data-toggle="tab"
                   href="#nav-MTM" role="tab" aria-controls="nav-MTM" aria-selected="false">Movement to Sound</a>
                <a class="nav-item nav-link" style="color: slategray;" id="nav-MTD-tab" data-toggle="tab"
                   href="#nav-MTD" role="tab" aria-controls="nav-MTD" aria-selected="false">Movement to Data</a>
            </div>
        </div>
    </nav>
</header>

<main>
    <div class="container" style="margin-top: 20px; margin-bottom: 20px; height: 100%;">
        <div class="row" style="height: 100%;">
            <div class="col-md-12" style="height: 100%;">
                <div class="tab-content" id="nav-tabContent" style="height: 100%;">

                    <div class="tab-pane fade show active" id="nav-STM" role="tabpanel" aria-labelledby="nav-STM-tab" style="height: 100%;">
                        <div class="jumbotron" style="height: 100%;">
                            <div class="row">
                                <div class="col-md-12">
                                    <a href="" data-toggle="modal" data-target="#slider-help"><code>Help me!</code></a>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="pitch-min">Pitch-minimum</label>
                                                <input type="number" class="form-control pitch-min" id="pitch-min"
                                                       value="0"
                                                       min="0">
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="pitch-max">Pitch-maximum</label>
                                                <input type="number" class="form-control pitch-max" id="pitch-max"
                                                       value="100"
                                                       min="0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="volume-range">Volume-range</label>
                                                <input type="range" class="form-control-range" id="volume-range"
                                                       value="0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="pitch-range">Pitch-range</label>
                                                <input type="range" class="form-control-range" id="pitch-range"
                                                       value="0">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="volume-result">Volume</label>
                                                <input type="text" class="form-control volume-data" id="volume-result"
                                                       value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="pitch-result">Pitch</label>
                                                <input type="text" class="form-control pitch-data" id="pitch-result"
                                                       value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="custom-control custom-switch">
                                                <input type="checkbox" class="custom-control-input" id="slider-music">
                                                <label class="custom-control-label" for="slider-music">Sound
                                                    on/off</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-MTM" role="tabpanel" aria-labelledby="nav-MTM-tab" style="height: 100%;">
                        <div class="jumbotron" style="height: 100%;">
                            <div class="row">
                                <div class="col-md-12">
                                    <a href="" data-toggle="modal" data-target="#movement-help"><code>Help me!</code></a>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="pitch-min-MTM">Pitch-minimum</label>
                                                <input type="number" class="form-control pitch-min" id="pitch-min-MTM"
                                                       value="0"
                                                       min="0">
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="pitch-max-MTM">Pitch-maximum</label>
                                                <input type="number" class="form-control pitch-max" id="pitch-max-MTM"
                                                       value="100"
                                                       min="0">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="x-MTM">Accel-x</label>
                                                <input type="text" class="form-control" id="x-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="y-MTM">Accel-y</label>
                                                <input type="text" class="form-control" id="y-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="vx-MTM">Speed-x</label>
                                                <input type="text" class="form-control" id="vx-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="vy-MTM">Speed-y</label>
                                                <input type="text" class="form-control" id="vy-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="px-MTM">Position x</label>
                                                <input type="text" class="form-control" id="px-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="py-MTM">Position y</label>
                                                <input type="text" class="form-control" id="py-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="volume-result-MTM">Volume</label>
                                                <input type="text" class="form-control volume-data"
                                                       id="volume-result-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <label for="pitch-result-MTM">Pitch</label>
                                                <input type="text" class="form-control pitch-data" id="pitch-result-MTM"
                                                       value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="d-MTM">Datapoints</label>
                                                <input type="text" class="form-control" id="d-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-group">
                                                <label for="i-MTM">Interval</label>
                                                <input type="text" class="form-control" id="i-MTM" value="0"
                                                       readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="custom-control custom-switch">
                                                <input type="checkbox" class="custom-control-input"
                                                       id="slider-music-MTM">
                                                <label class="custom-control-label" for="slider-music-MTM">Sound
                                                    on/off</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="nav-MTD" role="tabpanel" aria-labelledby="nav-MTD-tab" style="height: 100%">
                        <div class="jumbotron" style="height: 100%">
                            <div class="row">
                                <div class="col-md-12">
                                    <a href="" data-toggle="modal" data-target="#data-help"><code>Help me!</code></a>
                                </div>
                            </div>
                            <div class="row" style="height: 100%;">
                                <div class="col-12" style="height: 100%;">
                                    <canvas id="movementDataChart" style="width: 100%; height: auto;">
                                        <h1>Sorry, your browser does not support the canvas element :(</h1>
                                    </canvas>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 text-center">
                                    <button type="button" class="btn btn-danger btn-sm" style="width: 50%; align-content: center;" id="accel-btn">Acceleration</button>
                                </div>
                                <div class="col-md-4 text-center">
                                    <button type="button" class="btn btn-outline-warning btn-sm" style="width: 50%; align-content: center;" id="speed-btn">Speed</button>
                                </div>
                                <div class="col-md-4 text-center">
                                    <button type="button" class="btn btn-outline-success btn-sm" style="width: 50%; align-content: center;" id="pos-btn">Position</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input"
                                               id="slider-data-MTD">
                                        <label class="custom-control-label" for="slider-data-MTD">Tracking
                                            on/off</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Start modal -->
    <div class="modal fade" id="on-startup-modal" data-backdrop="static" data-keyboard="false" tabindex="-1"
         aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">ThereMove</h5>
                </div>
                <div class="modal-body">
                    <p>In this demo we will show three components of our research into the simulation of a theremin
                        device:</p>
                    <p>
                    <ul>
                        <li>
                            Mapping raw numerical data to a synthesiser.
                        </li>
                        <li>
                            Converting movement data from the accelerometer into positional data and mapping it into the
                            synthesiser.
                        </li>
                        <li>
                            Showing the difficulties involved with working on accelerometer data through raw data
                            plotting.
                        </li>
                    </ul>
                    </p>
                    <p>Please refer to the <code>top menu bar</code> to switch between the different modes. Please also
                        note that every page has an <code>help me</code> button for a small guide into the app.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-sm" id="start-app" data-dismiss="modal">Click on me
                        to start the app
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help modals -->
    <!-- Help sliders -->
    <div class="modal" id="slider-help" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sliders</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>On the slider page there are several input field and a few read only fields. Here we will quickly explain what each field does:</p>
                    <ul>
                        <li>
                        <div class="row">
                            <div class="col-sm-6">
                                <p>These sliders help you with dialing in a gradual change in either <b>volume</b> or <b>pitch</b>. For volume, the <i>minimum</i> is <b>1</b> and the <i>maximum</i> is <b>10</b>.</p>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="range-example">Volume or Pitch</label>
                                    <input type="range" class="form-control-range" id="range-example"
                                           value="0">
                                </div>
                            </div>
                        </div>
                        </li>
                        <li>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p>The <b>pitch</b> <i>minimum</i> and <i>maximum</i> allow you to dial in a minimum and maximum pitch height. The lowest you can go is <b>0</b> and the highest is for you to decide (well.. up to a certain point of course because human hearing is limited). You can then use the slider to get a point between these two values!</p>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="pitch-minmax-example">Pitch min/max example</label>
                                        <input type="number" class="form-control pitch-data" id="pitch-minmax-example"
                                               value="240">
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p>The readonly fields tell you the actual value of either <b>volume</b> or <b>pitch</b> which is being send to the sound synthesizer. The value in this field is entirely dependant on your input! Play around with the input field to see these values change.</p>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="result-example">Pitch example</label>
                                        <input type="text" class="form-control pitch-data" id="result-example"
                                               value="240 Hz"
                                               readonly>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p>The sound output is enabled or disabled with the toggle switch!</p>
                                </div>
                                <div class="col-sm-6">
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input"
                                               id="slider-example-sliders">
                                        <label class="custom-control-label" for="slider-example-sliders">on/off</label>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help movement -->
    <div class="modal" id="movement-help" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Movement to sound</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>On the movement to sound page there are several input field, a few read only fields and some other special characteristics. Here we will quickly explain what each component does:</p>
                    <ul>
                        <li>
                            <div class="row">
                                <div class="col-12">
                                    <p>In order to change the volume and pitch, it is required that you move your device about from side to side and up and down! Horizontal motion translates to a change in pitch and vertical motion changes the volume for you. The sound is not dependant on shaking for example, but more on linear motions.</p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p>The <b>pitch</b> <i>minimum</i> and <i>maximum</i> allow you to dial in a minimum and maximum pitch height. The lowest you can go is <b>0</b> and the highest is for you to decide (well.. up to a certain point of course because human hearing is limited). You can then use motion to get a point between these two values!</p>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="pitch-minmax-example-move">Pitch min/max example</label>
                                        <input type="number" class="form-control pitch-data" id="pitch-minmax-example-move"
                                               value="240">
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p>The readonly fields tell you the actual value of <b>volume</b> or <b>pitch</b> for example, but also the values caught by the accelerometer. The value in this field is entirely dependant on your input! Play around with the input field to see these values change.</p>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="result-example-move">Pitch example</label>
                                        <input type="text" class="form-control pitch-data" id="result-example-move"
                                               value="240 Hz"
                                               readonly>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p>The sound output is enabled or disabled with the toggle switch!</p>
                                </div>
                                <div class="col-sm-6">
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input"
                                               id="slider-example-sliders-move">
                                        <label class="custom-control-label" for="slider-example-sliders-move">on/off</label>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help movement -->
    <div class="modal" id="data-help" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Movement to data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>On the movement to data page you can see the raw output of the sensors and the corresponding calculated data. Here we will quickly explain what each component does:</p>
                    <ul>
                        <li>
                            <div class="row">
                                <div class="col-12">
                                    <p>When you turn on the motion capturing feature with the slider, to app will start to record every little movement of the device. All the movement will be translated to data and it will be plotted for you to see.</p>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p>You can use one of the three buttons below the chart to display different characteristics. You can choose between <b>acceleration</b>, <b>speed</b> and <b>position</b>.</p>
                                </div>
                                <div class="col-sm-6">
                                    <div class="col-md-4 text-center">
                                        <button type="button" class="btn btn-danger btn-sm">Acceleration</button>
                                    </div>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="row">
                                <div class="col-sm-6">
                                    <p>The data capture is enabled or disabled with the toggle switch!</p>
                                </div>
                                <div class="col-sm-6">
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input"
                                               id="slider-example-sliders-data">
                                        <label class="custom-control-label" for="slider-example-sliders-data">on/off</label>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</main>

</body>
</html>
<script>
    const chartSize = 200;
    var chartLabels = new Array(chartSize);
    for (var i = 0; i < chartLabels.length; i++) {
        chartLabels[i] = i + 1;
    }

    var chartField = $("#movementDataChart")[0].getContext("2d");
    var chart = new Chart(chartField, {
        // The type of chart we want to create
        type: "line",

        // The data for our dataset
        data: {
            labels: chartLabels,
            datasets: [
                {
                    label: "Acceleration X",
                    borderColor: 'rgb(255, 99, 132)',
                    data: []
                },
                {
                    label: "Acceleration Y",
                    borderColor: 'rgb(50, 168, 82)',
                    data: []
                }
            ]
        },

        // Configuration options go here
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        suggestedMin: -1,
                        suggestedMax: 1
                    }
                }],
                xAxes: [{
                    display: false
                }]
            }
        }
    });

    const synth = new Tone.Synth().toDestination();
    const now = Tone.now()

    const volumeMax = 10;
    const volumeMin = 0;
    var volumeRange = 100;
    var volumeActual = 10;

    var pitchMax = 500;
    var pitchMin = 80;
    var pitchRange = 0;
    var pitchActual = 0;

    var soundEnabled = false;
    var soundRunning = false;

    /* Setup page data */

    $(document).ready(function () {
        $("#on-startup-modal").modal();

        reset();
    })

    function updateMovementToSoundFields() {
        $("#x-MTM").val(a_x + " ms2");
        $("#y-MTM").val(a_y + " ms2");
        $("#i-MTM").val(a_i + " msec");
        $("#vy-MTM").val(v_y + " ms");
        $("#vx-MTM").val(v_x + " ms");
        $("#px-MTM").val(p_x);
        $("#py-MTM").val(p_y);
        $("#d-MTM").val(datapoints);
    }

    function reset() {
        // Reset checkboxes
        $("#slider-data-MTD").prop('checked', false);
        $("#slider-music-MTM").prop('checked', false);
        $("#slider-music").prop('checked', false);

        // Reset sound control
        soundEnabled = false;
        soundRunning = false;

        // Reset JS variables
        volumeRange = 100;
        volumeActual = 10;
        pitchRange = 0;
        pitchMax = 500;
        pitchMin = 0;
        pitchActual = 0;

        // Reset movement variables
        datapoints = 0;
        p_x = 0;
        p_y = 0;
        v_x = 0;
        v_y = 0;
        a_x = 0;
        a_y = 0;
        a_i = 0;

        // Reset DOM fields
        updateSlidersFields();
        updateMovementToSoundFields();
        $(".volume-data").val(volumeActual);
        $(".pitch-min").val(pitchMin);
        $(".pitch-max").val(pitchMax);
        $(".pitch-data").val(pitchActual + " Hz");

        sliderPage();
        movementToSoundPage();
        movementToDataPage();
    }

    $("#nav-STM-tab").on("click", function (e) {
        reset();
    })

    $("#nav-MTM-tab").on("click", function (e) {
        reset();
    })

    $("#nav-MTD-tab").on("click", function (e) {
        reset();
    })

    /* Sound running functions */

    function updateVolumeActual(volumeRange, volumeRangeSize = 100) {
        volumeActual = Math.round(volumeMin + ((volumeMax - volumeMin) * (volumeRange / volumeRangeSize)));
        $(".volume-data").val(volumeActual);

        if (soundEnabled) {
            if (volumeActual === 0) {
                if (soundRunning) {
                    synth.triggerRelease(now);
                    soundRunning = false;
                }
            } else {
                if (soundRunning)
                    synth.volume.rampTo(volumeActual, 0.1);
                else {
                    synth.triggerAttack(pitchActual, now);
                    soundRunning = true;
                }
            }
        }
    }

    function updatePitchActual(pitchRange, pitchRangeSize = 100) {
        pitchActual = Math.round(pitchMin + ((pitchMax - pitchMin) * (pitchRange / pitchRangeSize)));
        $(".pitch-data").val(pitchActual + " Hz");

        if (soundEnabled) {
            synth.frequency.rampTo(pitchActual, 0.1);
        }
    }

    /* Motion setup */
    var a_x;
    var a_y;
    var a_i;
    var datapoints = 0;

    var v_x = 0;
    var p_x = 0;

    var v_y = 0;
    var p_y = 0;

    function motionHandler(event) {
        a_x = event.acceleration.x;
        a_y = event.acceleration.y;
        a_i = event.interval;

        v_x = v_x + a_x * a_i;
        v_y = v_y + a_y * a_i;
        p_x = p_x + v_x * a_i;
        p_y = p_y + v_y * a_i;

        if (p_x < 0)
            p_x = 0;
        else if (p_x > 10)
            p_x = 10;

        if (p_y < 0)
            p_y = 0;
        else if (p_y > 10)
            p_y = 10;

        datapoints += 1;
    }

    accessRequestFault = false;

    function requestMotionPermission() {
        if (!accessRequestFault && typeof (DeviceMotionEvent) !== "undefined" && typeof (DeviceMotionEvent.requestPermission) === "function") {
            DeviceMotionEvent.requestPermission().then(response => {
                // (optional) Do something after API prompt dismissed.
                if (response !== "granted") {
                    alert("Warning: Your device has either blocked access to your movement devices or does not have them.");
                    alert("This application requires data from the accelerometer to function correctly.");
                    accessRequestFault = true;
                }
            })
        }
    }

    /* MOTION TO DATA */

    mapAccel = true;
    mapSpeed = false;
    mapPos = false;

    function resetChart() {
        chart.data.datasets[0].data = [];
        chart.data.datasets[1].data = [];

        chart.update();
    }

    function setChartSize(size = 50) {
        chart.options.scales.yAxes[0].ticks.suggestedMax = size;
        chart.options.scales.yAxes[0].ticks.suggestedMin = -size;
    }

    function motionToDataHandler(event) {
        motionHandler(event);

        if (chart.data.datasets[0].data.length > chartSize || chart.data.datasets[1].data.length > chartSize)
            resetChart();

        if (mapAccel) {
            chart.data.datasets[0].data.push(a_x);
            chart.data.datasets[1].data.push(a_y);
        } else if (mapSpeed) {
            chart.data.datasets[0].data.push(v_x);
            chart.data.datasets[1].data.push(v_y);
        } else if (mapPos) {
            chart.data.datasets[0].data.push(p_x);
            chart.data.datasets[1].data.push(p_y);
        }

        chart.update();
    }

    function movementToDataPage() {
        if ($("#slider-data-MTD").prop("checked")) {
            requestMotionPermission();

            window.addEventListener("devicemotion", motionToDataHandler);
        } else {
            window.removeEventListener("devicemotion", motionToDataHandler);
        }
    }

    $("#slider-data-MTD").click(function (e) {
        movementToDataPage();
    })

    $("#accel-btn").click(function (e) {
        e.preventDefault();
        $(this).removeClass("btn-outline-danger").addClass("btn-danger");
        $("#speed-btn").removeClass("btn-warning").addClass("btn-outline-warning");
        $("#pos-btn").removeClass("btn-success").addClass("btn-outline-success");

        chart.data.datasets[0].label = "Acceleration X";
        chart.data.datasets[1].label = "Acceleration Y";

        mapAccel = true;
        mapSpeed = false;
        mapPos = false;

        setChartSize(1);
        resetChart();
    })

    $("#speed-btn").click(function (e) {
        e.preventDefault();
        $(this).removeClass("btn-outline-warning").addClass("btn-warning");
        $("#accel-btn").removeClass("btn-danger").addClass("btn-outline-danger");
        $("#pos-btn").removeClass("btn-success").addClass("btn-outline-success");

        chart.data.datasets[0].label = "Speed X";
        chart.data.datasets[1].label = "Speed Y";

        mapAccel = false;
        mapSpeed = true;
        mapPos = false;

        setChartSize(5);
        resetChart();
    })

    $("#pos-btn").click(function (e) {
        e.preventDefault();
        $(this).removeClass("btn-outline-success").addClass("btn-success");
        $("#accel-btn").removeClass("btn-danger").addClass("btn-outline-danger");
        $("#speed-btn").removeClass("btn-warning").addClass("btn-outline-warning");

        chart.data.datasets[0].label = "Position X";
        chart.data.datasets[1].label = "Position Y";

        mapAccel = false;
        mapSpeed = false;
        mapPos = true;

        setChartSize(10);
        resetChart();
    })

    /* MOTION TO SOUND */

    function motionToSoundHandler(event) {
        motionHandler(event);

        updatePitchActual(p_x * 10);
        updateVolumeActual(p_y * 10);

        updateMovementToSoundFields();
    }

    function movementToSoundPage() {
        if ($("#slider-music-MTM").prop("checked")) {
            requestMotionPermission();

            if (volumeActual > 0)
                soundRunning = true
            if (soundRunning) {
                synth.triggerAttack(pitchActual, now);
                synth.volume.rampTo(volumeActual, 0.1);
            }
            soundEnabled = true;

            window.addEventListener("devicemotion", motionToSoundHandler);
        } else {
            window.removeEventListener("devicemotion", motionToSoundHandler);
            synth.triggerRelease(now);
            soundEnabled = false;
            soundRunning = false;
        }
    }

    $("#slider-music-MTM").click(function (e) {
        movementToSoundPage();
    })

    /* SLIDER */

    /* Data fetching from the slider section */

    $(document).on("input", "#volume-range", function () {
        volumeRange = $(this).val();
        updateVolumeActual(volumeRange, 100);
    });

    $(document).on("input", "#pitch-range", function () {
        pitchRange = $(this).val();
        updatePitchActual(pitchRange, 100);
    });

    $(document).on("input", ".pitch-min", function () {
        pitchMin = parseInt($(this).val());
        updatePitchActual(pitchRange, 100);
    });

    $(document).on("input", ".pitch-max", function () {
        pitchMax = parseInt($(this).val());
        updatePitchActual(pitchRange, 100);
    });

    /* Slider run function */

    function updateSlidersFields() {
        $("#volume-range").val(volumeRange);
        $("#pitch-range").val(pitchRange);
    }

    function sliderPage() {
        if ($("#slider-music").prop("checked")) {
            if (volumeActual > 0)
                soundRunning = true
            if (soundRunning) {
                synth.triggerAttack(pitchActual, now);
                synth.volume.rampTo(volumeActual, 0.1);
            }
            soundEnabled = true;
        } else {
            synth.triggerRelease(now);
            soundEnabled = false;
            soundRunning = false;
        }
    }

    /* Start slider page */

    $("#start-app").click(function (e) {
        Tone.start();

        $("#slider-music").click(function (e) {
            sliderPage();
        })
    })
</script>